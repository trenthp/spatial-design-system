<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spatial Design System Explorer</title>
  <meta name="description" content="Interactive exploration of spatial UI patterns">
  <!-- Suppress THREE.js deprecation warnings before loading -->
  <script>
    // Capture the original console.warn
    const originalWarn = console.warn;
    console.warn = function(...args) {
      // Filter out useLegacyLights and mergeBufferGeometries warnings
      if (args[0] && typeof args[0] === 'string' &&
          (args[0].includes('useLegacyLights') || args[0].includes('mergeBufferGeometries'))) {
        return; // Suppress these warnings
      }
      originalWarn.apply(console, args);
    };
  </script>
  <!-- A-Frame core library - must load first -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.6.0/dist/aframe-master.min.js"></script>
  <!-- A-Frame components - load after core -->
  <script src="https://unpkg.com/aframe-environment-component@1.4.0/dist/aframe-environment-component.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
  <!-- Movement controls for keyboard, mobile, and VR controllers -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
</head>
<body>
  <a-scene>
    <!-- Environment -->
    <a-entity environment="preset: forest; dressingAmount: 500"></a-entity>

    <!-- Lighting -->
    <a-entity light="type: ambient; color: #BBB"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 1" position="-5 10 5" shadow="cast: true; receive: true; shadowMapWidth: 1024; shadowMapHeight: 1024; shadowCameraLeft: -20; shadowCameraRight: 20; shadowCameraTop: 20; shadowCameraBottom: -20; shadowCameraFar: 50; shadowBias: -0.0008; shadowNormalBias: 0.05"></a-entity>

    <!-- Welcome Sign -->
    <a-text value="SPATIAL UI PATTERNS\n\nControls:\nDesktop: WASD + Mouse\nMobile: Touch joystick + Look around\nVR: Thumbstick + Point with controllers"
            position="0 3 -3"
            align="center"
            color="#ffffff"
            width="6"
            negate="false" font=""></a-text>

    <!-- PATTERN 1: Billboard Button (Always faces user) -->
    <a-entity position="-3 1.6 -4">
      <!-- The actual button -->
      <a-box
        id="billboard-btn"
        color="#4A90E2"
        depth="0.1"
        height="0.5"
        width="1.2"
        billboard="true"
        class="clickable"
        event-set__enter="scale: 1.1 1.1 1.1"
        event-set__leave="scale: 1 1 1"
        event-set__click="color: #7FB3FF"
        animation__click="property: rotation; to: 0 360 0; dur: 1000; startEvents: click">
        <!-- Button label -->
        <a-text value="CLICK ME"
                position="0 0 0.06"
                align="center"
                color="#ffffff"
                width="2"
                negate="false" font=""></a-text>
      </a-box>

      <!-- Pattern description -->
      <a-text value="BILLBOARD BUTTON\nAlways faces the user\nUseful for: Critical alerts, attention-grabbing CTAs"
              position="0 -0.7 0"
              align="center"
              color="#ffffff"
              width="3"
              negate="false" font=""></a-text>
    </a-entity>

    <!-- PATTERN 2: Diegetic Menu (Exists in 3D world) -->
    <a-entity position="0 1.6 -4">
      <!-- Holographic panel -->
      <a-plane
        id="diegetic-menu"
        color="#E24A90"
        opacity="0.8"
        height="1.5"
        width="1.2"
        class="clickable"
        event-set__click="opacity: 1"
        shadow="cast: true; receive: true">

        <!-- Menu items -->
        <a-box color="#ffffff"
               position="0 0.4 0.01"
               depth="0.02"
               height="0.2"
               width="1"
               class="clickable"
               event-set__click="color: #4A90E2; material.opacity: 0.5"
               animation__click="property: scale; from: 1 1 1; to: 0.95 0.95 0.95; dur: 100; easing: easeInOutQuad">
          <a-text value="Option 1" position="0 0 0.02" align="center" width="1.5" color="#000000" negate="false" font=""></a-text>
        </a-box>

        <a-box color="#ffffff"
               position="0 0 0.01"
               depth="0.02"
               height="0.2"
               width="1"
               class="clickable"
               event-set__click="color: #4A90E2">
          <a-text value="Option 2" position="0 0 0.02" align="center" width="1.5" color="#000000" negate="false" font=""></a-text>
        </a-box>

        <a-box color="#ffffff"
               position="0 -0.4 0.01"
               depth="0.02"
               height="0.2"
               width="1"
               class="clickable"
               event-set__click="color: #4A90E2">
          <a-text value="Option 3" position="0 0 0.02" align="center" width="1.5" color="#000000" negate="false" font=""></a-text>
        </a-box>
      </a-plane>

      <!-- Pattern description -->
      <a-text value="DIEGETIC MENU\nFixed in 3D space\nUseful for: Persistent controls, spatial context"
              position="0 -1.2 0"
              align="center"
              color="#ffffff"
              width="3"
              negate="false" font=""></a-text>
    </a-entity>

    <!-- PATTERN 3: Distance-Scaled UI -->
    <a-entity position="3 1.6 -4">
      <!-- Button that scales with distance -->
      <a-sphere
        id="distance-scaled"
        color="#90E24A"
        radius="0.3"
        class="clickable"
        event-set__click="color: #B4FF6E">
        <a-text value="INFO"
                position="0 0 0.31"
                align="center"
                color="#000000"
                width="2"
                negate="false" font=""></a-text>
      </a-sphere>

      <!-- Pattern description -->
      <a-text value="DISTANCE SCALING\nSize adapts to proximity\nUseful for: Readable UI at any distance"
              position="0 -0.7 0"
              align="center"
              color="#ffffff"
              width="3"
              negate="false" font=""></a-text>
    </a-entity>

    <!-- Camera rig (player) with movement controls -->
    <a-entity id="rig"
              movement-controls="fly: false; speed: 0.15; constrainToNavMesh: false"
              position="0 0 0">
      <a-camera position="0 1.6 0">
        <!-- Reticle for desktop/mobile gaze-based interaction -->
        <a-cursor
          color="#4A90E2"
          fuse="true"
          fuse-timeout="1500"
          raycaster="objects: .clickable"></a-cursor>
      </a-camera>

      <!-- VR Controllers (Meta Quest, etc.) -->
      <!-- Left controller -->
      <a-entity id="leftHand"
                laser-controls="hand: left"
                raycaster="objects: .clickable; lineColor: #4A90E2; lineOpacity: 0.75"
                line="color: #4A90E2; opacity: 0.75">
        <!-- Simple controller visualization -->
        <a-cylinder color="#4A90E2" height="0.15" radius="0.03" rotation="90 0 0"></a-cylinder>
        <a-sphere color="#7FB3FF" radius="0.02" position="0 0 -0.075"></a-sphere>
      </a-entity>

      <!-- Right controller -->
      <a-entity id="rightHand"
                laser-controls="hand: right"
                raycaster="objects: .clickable; lineColor: #4A90E2; lineOpacity: 0.75"
                line="color: #4A90E2; opacity: 0.75">
        <!-- Simple controller visualization -->
        <a-cylinder color="#4A90E2" height="0.15" radius="0.03" rotation="90 0 0"></a-cylinder>
        <a-sphere color="#7FB3FF" radius="0.02" position="0 0 -0.075"></a-sphere>
      </a-entity>
    </a-entity>

    <!-- Ground plane for shadow receiving but terrible tearing -->
    <!-- <a-plane position="0 0 0"
             rotation="-90 0 0"
             width="100"
             height="100"
             color="#1A1A1A"
             opacity="0.3"
             shadow="receive: true"></a-plane> -->
  </a-scene>

  <!-- Add custom distance scaling behavior -->
  <script>
    // Billboard component - makes entity always face the camera
    AFRAME.registerComponent('billboard', {
      init: function() {
        this.camera = null;
      },

      tick: function() {
        if (!this.camera) {
          this.camera = document.querySelector('[camera]');
          if (!this.camera) return;
        }

        // Get camera and entity positions
        var cameraPos = this.camera.object3D.position;
        var entityPos = this.el.object3D.position;

        // Make entity look at camera
        this.el.object3D.lookAt(cameraPos);
      }
    });

    AFRAME.registerComponent('distance-scale', {
      schema: {
        minDistance: {type: 'number', default: 1},
        maxDistance: {type: 'number', default: 10},
        minScale: {type: 'number', default: 0.5},
        maxScale: {type: 'number', default: 2}
      },

      init: function() {
        this.camera = null;
      },

      tick: function() {
        // Find camera on first tick
        if (!this.camera) {
          this.camera = document.querySelector('[camera]');
          if (!this.camera) return;
        }

        var distance = this.el.object3D.position.distanceTo(
          this.camera.object3D.position
        );

        // Normalize distance: 0 when close, 1 when far (reversed)
        var normalizedDistance = Math.max(0, Math.min(1,
          (distance - this.data.minDistance) /
          (this.data.maxDistance - this.data.minDistance)
        ));

        var scale = this.data.minScale +
          (this.data.maxScale - this.data.minScale) * normalizedDistance;

        this.el.object3D.scale.set(scale, scale, scale);
      }
    });

    // Apply distance scaling to the entity containing the sphere
    document.addEventListener('DOMContentLoaded', function() {
      var sceneEl = document.querySelector('a-scene');
      if (sceneEl) {
        sceneEl.addEventListener('loaded', function() {
          var distanceScaledParent = document.querySelector('#distance-scaled').parentElement;
          distanceScaledParent.setAttribute('distance-scale', '');
        });
      }
    });
  </script>
</body>
</html>
